{% extends "base.html" %}

{% block title %}Sync History - {{ config.name }}{% endblock %}

{% block extra_css %}
<style>
    .time-cell {
        white-space: nowrap;
        cursor: help;
    }
</style>
{% endblock %}

{% block content %}
<h2>Sync History</h2>

<div class="card">
    <h3>All Sync Operations</h3>
    {% if history %}
    <table>
        <thead>
            <tr>
                <th>Time</th>
                <th>Organization</th>
                <th>Users</th>
                <th>Duration</th>
                <th>Status</th>
                <th>Error</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in history %}
            <tr>
                <td class="time-cell text-muted" title="{{ entry.synced_at }}">
                    {{ time_ago(entry.synced_at) }}
                </td>
                <td><strong>{{ config.buz_orgs[entry.org_key].display_name if config.buz_orgs[entry.org_key] else entry.org_key }}</strong></td>
                <td>{{ entry.user_count }}</td>
                <td>{{ "%.1f"|format(entry.duration_seconds) }}s</td>
                <td>
                    <span class="badge badge-{% if entry.status == 'success' %}success{% else %}error{% endif %}">
                        {{ entry.status }}
                    </span>
                </td>
                <td class="text-danger">{{ entry.error_message or '' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted">No sync operations recorded yet.</p>
    {% endif %}
</div>

{% endblock %}
