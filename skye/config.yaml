name: Skye
description: Scheduler Bot - centralized task scheduling for the bot team
version: 1.0.0
personality: Punctual and reliable, ensures everything happens at the right time

server:
  host: 0.0.0.0
  # port is read from chester/config.yaml via shared/config/ports.py

database:
  path: "database/skye.db"

# Scheduler configuration
scheduler:
  # Timezone for scheduled jobs (Australia/Sydney for local business hours)
  timezone: "Australia/Sydney"
  # How often to check for missed jobs on startup (in minutes)
  misfire_grace_time: 60
  # Maximum concurrent jobs
  max_instances: 3

# Default job configurations
# These can be referenced when creating new jobs
job_templates:
  fiona_mavis_sync:
    name: "Fiona-Mavis Sync"
    description: "Sync fabric descriptions between Fiona and Mavis"
    target_bot: "fiona"
    endpoint: "/api/sync/auto"
    method: "POST"
    # Default: every 4 hours
    schedule:
      type: "cron"
      hour: "*/4"
      minute: "0"

  mavis_unleashed_sync:
    name: "Mavis-Unleashed Sync"
    description: "Sync product data from Unleashed API"
    target_bot: "mavis"
    endpoint: "/api/sync/run"
    method: "POST"
    # Default: every 4 hours
    schedule:
      type: "cron"
      hour: "*/4"
      minute: "30"

  monica_cleanup:
    name: "Monica Heartbeat Cleanup"
    description: "Clean up old heartbeat records from Monica"
    target_bot: "monica"
    endpoint: "/api/cleanup"
    method: "POST"
    # Default: daily at 3am
    schedule:
      type: "cron"
      hour: "3"
      minute: "0"

  hugo_sync:
    name: "Hugo Buz User Sync"
    description: "Sync user data from Buz to Hugo's cache"
    target_bot: "hugo"
    endpoint: "/api/users/sync"
    method: "POST"
    # Default: daily at 6am (before work starts)
    schedule:
      type: "cron"
      hour: "6"
      minute: "0"

  hugo_groups_sync:
    name: "Hugo Buz Groups Sync"
    description: "Sync available user groups from Buz to Hugo's cache"
    target_bot: "hugo"
    endpoint: "/api/groups/sync"
    method: "POST"
    # Default: daily at 5:55am (just before user sync)
    schedule:
      type: "cron"
      hour: "5"
      minute: "55"

  hugo_queue_process:
    name: "Hugo Queue Process"
    description: "Process pending Buz user changes"
    target_bot: "hugo"
    endpoint: "/api/queue/process"
    method: "POST"
    # Default: every 15 minutes
    schedule:
      type: "cron"
      minute: "*/15"

  hugo_queue_cleanup:
    name: "Hugo Queue Cleanup"
    description: "Clean up old completed/failed queue entries"
    target_bot: "hugo"
    endpoint: "/api/queue/clear"
    method: "POST"
    body:
      days: 7
    # Default: weekly on Sunday at 4am
    schedule:
      type: "cron"
      day_of_week: "sun"
      hour: "4"
      minute: "0"

  hugo_auth_check:
    name: "Hugo Auth Health Check"
    description: "Check Buz auth sessions are still valid"
    target_bot: "hugo"
    endpoint: "/api/auth/check"
    method: "POST"
    # Default: every 6 hours
    schedule:
      type: "cron"
      hour: "*/6"
      minute: "30"

  ivy_sync:
    name: "Ivy Inventory & Pricing Sync"
    description: "Sync inventory items and pricing from Buz for all orgs"
    target_bot: "ivy"
    endpoint: "/api/sync/all-orgs"
    method: "POST"
    body:
      include_inactive: true
      performed_by: "skye"
      wait_for_lock: true  # Wait for Playwright lock instead of failing
    # Default: daily at 5am (before Hugo user sync)
    # Runs async - returns immediately, background threads do the work
    # If another bot is using Playwright, will wait (status: waiting_for_lock)
    schedule:
      type: "cron"
      hour: "5"
      minute: "0"

  paige_sync:
    name: "Paige Wiki User Sync"
    description: "Sync DokuWiki users with Peter staff directory"
    target_bot: "paige"
    endpoint: "/api/sync"
    method: "POST"
    # Daily at 6:30am (after Hugo user sync at 6am)
    # Syncs wiki users with Peter's staff directory
    # Adds users with wiki_access, removes departed staff (but never admins)
    schedule:
      type: "cron"
      hour: "6"
      minute: "30"

# Admin access configuration
admin:
  emails:
    # Add admin email addresses here, or set SKYE_ADMIN_EMAILS env var
    # - admin@watsonblinds.com.au

# Authentication configuration
# Uses Chester's auth gateway for Google OAuth
auth:
  mode: grant  # Use Grant for centralized authorization

